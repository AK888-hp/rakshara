{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="student-dashboard d-flex align-items-center justify-content-center py-5">
  <div class="container animate-fade-in">

    <!-- ðŸ‘©â€ðŸŽ“ Header -->
    <div class="card shadow-lg p-4 rounded-4 bg-white mb-4 text-center">
      <h2 class="fw-bold text-gradient mb-2">{{ profile.user.get_full_name }}'s Dashboard</h2>
      <p class="text-muted mb-0">ðŸŽ“ Student ID: <strong>{{ profile.student_code }}</strong></p>
    </div>

    <!-- ðŸ’“ Health Summary -->
    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <div class="summary-card shadow-sm rounded-4 text-center py-4">
          <h5 class="text-muted">Heart Rate</h5>
          <h3 class="fw-bold text-danger">{{ latest_vital.heart_rate|default:"--" }} <small>bpm</small></h3>
        </div>
      </div>
      <div class="col-md-4">
        <div class="summary-card shadow-sm rounded-4 text-center py-4">
          <h5 class="text-muted">SpOâ‚‚</h5>
          <h3 class="fw-bold text-success">{{ latest_vital.spo2|default:"--" }} <small>%</small></h3>
        </div>
      </div>
      <div class="col-md-4">
        <div class="summary-card shadow-sm rounded-4 text-center py-4">
          <h5 class="text-muted">Temperature</h5>
          <h3 class="fw-bold text-primary">{{ latest_vital.temperature_c|default:"--" }} <small>Â°C</small></h3>
        </div>
      </div>
    </div>

    <!-- ðŸ“Š Health Trends -->
    <div class="card shadow-lg p-4 rounded-4 mb-4">
      <h4 class="fw-semibold mb-3 text-gradient">ðŸ“ˆ Health Progress</h4>
      <canvas id="hrChart" height="200"></canvas>
    </div>

    <!-- ðŸ“‹ Recent Records -->
    <div class="card shadow-lg p-4 rounded-4 bg-white mb-4">
      <h4 class="fw-semibold mb-3 text-gradient">ðŸ©º Recent Health Records</h4>
      {% if vitals %}
      <div class="table-responsive">
        <table class="table table-hover text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Heart Rate</th>
              <th>SpOâ‚‚</th>
              <th>Temperature</th>
              <th>Prediction</th>
            </tr>
          </thead>
          <tbody>
            {% for v in vitals %}
            <tr>
              <td>{{ v.recorded_at|date:"M d, H:i" }}</td>
              <td>{{ v.heart_rate }}</td>
              <td>{{ v.spo2 }}</td>
              <td>{{ v.temperature_c }}</td>
              <td>{{ v.prediction_score }} ({{ v.prediction_label }})</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted fst-italic">No records available yet.</p>
      {% endif %}
    </div>

    <!-- âž• Add Vitals -->
    <div class="text-center">
      <a href="{% url 'add_vital' %}" class="btn btn-success rounded-pill px-4 py-2 shadow-sm">âž• Add New Vitals</a>
    </div>

  </div>
</div>

<!-- ðŸ“Š Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = {{ labels|safe }};
const hrData = {{ hr_data|safe }};
const spo2Data = {{ spo2_data|safe }};
const tempData = {{ temp_data|safe }};

new Chart(document.getElementById('hrChart'), {
  type: 'line',
  data: {
    labels: labels,
    datasets: [
      {
        label: 'Heart Rate (bpm)',
        data: hrData,
        borderColor: '#dc3545',
        backgroundColor: 'rgba(220,53,69,0.1)',
        fill: true,
        tension: 0.4
      },
      {
        label: 'SpOâ‚‚ (%)',
        data: spo2Data,
        borderColor: '#28a745',
        backgroundColor: 'rgba(40,167,69,0.1)',
        fill: true,
        tension: 0.4
      },
      {
        label: 'Temperature (Â°C)',
        data: tempData,
        borderColor: '#007bff',
        backgroundColor: 'rgba(0,123,255,0.1)',
        fill: true,
        tension: 0.4
      }
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'top' } },
    scales: {
      x: { title: { display: true, text: 'Recorded Time' } },
      y: { title: { display: true, text: 'Values' } }
    }
  }
});
</script>

<!-- ðŸŒˆ Styling -->
<style>
.student-dashboard {
  background: linear-gradient(-45deg, #007bff, #00c6ff, #17a2b8, #6f42c1);
  background-size: 400% 400%;
  animation: gradientFlow 15s ease infinite;
  min-height: calc(100vh - 60px);
}

.text-gradient {
  background: linear-gradient(90deg, #007bff, #00c6ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.summary-card {
  background: #ffffffdd;
  border: 1px solid #eee;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}
.summary-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.animate-fade-in {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInUp 1s ease forwards;
}

@keyframes fadeInUp {
  to { opacity: 1; transform: translateY(0); }
}

@keyframes gradientFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>

{% endblock %}
